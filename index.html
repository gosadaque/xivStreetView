<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
	
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>  
	
	<script src="https://kit.fontawesome.com/6a82835f2f.js" crossorigin="anonymous"></script>
	
	<script type="text/javascript" src="maps.json"></script>
	
	<link rel="stylesheet" href="main.css">

    <title>xivStreetView</title>
	
</head>
<body>
    
    <section>
		
		<div class='infoTop' id='navMenuId'>
		   <div class='dropdown'>
				<button class='dropbtn'>Abalathian Spire<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" onclick='setMapJPEG("AzysLla")'>Azys Lla</a>
					<a href="#" onclick='setMapJPEG("TheSeaOfClouds")'>The Sea Of Clouds</a>
				</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Coerthas & Mor Dhona<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" onclick='setMapJPEG("CoerthasCentralHighlands")'>Coerthas Central Highlands</a>
					<a href="#" onclick='setMapJPEG("CoerthasWesternHighlands")'>Coerthas Western Highlands</a>
					<a href="#" onclick='setMapJPEG("IshgardFoundation")'>Ishgard - Foundation</a>
					<a href="#" onclick='setMapJPEG("IshgardThePillars")'>Ishgard - The Pillars</a>
					<a href="#" onclick='setMapJPEG("MorDhona")'>Mor Dhona</a>
				</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Dravania<i class='fa fa-caret-down'></i></button>
					<div class='dropdown-content'>
						<a href="#" onclick='setMapJPEG("TheChurningMists")'>The Churning Mists</a>
						<a href="#" onclick='setMapJPEG("TheDravanianForelands")'>The Dravanian Forelands</a>
						<a href="#" onclick='setMapJPEG("TheDravanianHinterlands")'>The Dravanian Hinterlands</a>
						<a href="#" onclick='setMapJPEG("Idyllshire")'>Idyllshire</a>
					</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Gyr Abania<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" onclick='setMapJPEG("TheFringes")'>The Fringes</a>
					<a href="#" onclick='setMapJPEG("TheLochs")'>The Lochs</a>
					<a href="#" onclick='setMapJPEG("ThePeaks")'>The Peaks</a>
					<a href="#" onclick='setMapJPEG("RhalgrsReach")'>Rhalgr's Reach</a>
				</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>La Noscea<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" onclick='setMapJPEG("LimsaLominsaLowerDecks")'>Limsa Lominsa Lower Decks</a>
					<a href="#" onclick='setMapJPEG("LimsaLominsaUpperDecks")'>Limsa Lominsa Upper Decks</a>
					<a href="#" onclick='setMapJPEG("EasternLaNoscea")'>Eastern La Noscea</a>
					<a href="#" onclick='setMapJPEG("LowerLaNoscea")'>Lower La Noscea</a>
					<a href="#" onclick='setMapJPEG("MiddleLaNoscea")'>Middle La Noscea</a>
					<a href="#" onclick='setMapJPEG("OuterLaNoscea")'>Outer La Noscea</a>
					<a href="#" onclick='setMapJPEG("UpperLaNoscea")'>Upper La Noscea</a>
					<a href="#" onclick='setMapJPEG("WesternLaNoscea")'>Western La Noscea</a>
					<a href="#" onclick='setMapJPEG("WolvesDenPier")'>Wolves' Den Pier</a>
				</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Thanalan<i class='fa fa-caret-down'></i></button>
					<div class='dropdown-content'>
						<a href="#" onclick='setMapJPEG("CentralThanalan")'>Central Thanalan</a>
						<a href="#" onclick='setMapJPEG("EasternThanalan")'>Eastern Thanalan</a>
						<a href="#" onclick='setMapJPEG("NorthernThanalan")'>Northern Thanalan</a>
						<a href="#" onclick='setMapJPEG("SouthernThanalan")'>Southern Thanalan</a>
						<a href="#" >Ul'dah - Steps of Nald</a>
						<a href="#" >Ul'dah - Steps of Thal</a>
						<a href="#" onclick='setMapJPEG("WesternThanalan")'>Western Thanalan</a>
						<a href="#" >The Goblet</a>
						<a href="#" onclick='setMapJPEG("TheGoldSaucer")'>The Gold Saucer</a>
					</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Black Shroud<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" onclick='setMapJPEG("CentralShroud")'>Central Shroud</a>
					<a href="#" onclick='setMapJPEG("EastShroud")'>East Shroud</a>
					<a href="#" onclick='setMapJPEG("NewGridania")'>New Gridania</a>
					<a href="#" onclick='setMapJPEG("OldGridania")'>Old Gridania</a>
					<a href="#" onclick='setMapJPEG("NorthShroud")'>North Shroud</a>
					<a href="#" onclick='setMapJPEG("SouthShroud")'>South Shroud</a>
					<a href="#" >The Lavender Beds</a>
				</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Far East<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" ><u>Hingashi:</u></a>
					<a href="#" onclick='setMapJPEG("Kugane")'>Kugane</a>
					<a href="#" >Shirogane</a>
					<a href="#" ><u>Othard:</u></a>
					<a href="#" onclick='setMapJPEG("TheAzimSteppe")'>The Azim Steppe</a>
					<a href="#" onclick='setMapJPEG("TheRubySea")'>The Ruby Sea</a>
					<a href="#" onclick='setMapJPEG("Yanxia")'>Yanxia</a>
				</div>
		   </div>
		   <div class='dropdown'>
				<button class='dropbtn'>Norvrandt<i class='fa fa-caret-down'></i></button>
				<div class='dropdown-content'>
					<a href="#" onclick='setMapJPEG("AmhAraeng")'>Amh Araeng</a>
					<a href="#" onclick='setMapJPEG("TheCrystiarium")'>The Crystiarium</a>
					<a href="#" >Eulmore</a>
					<a href="#" onclick='setMapJPEG("IlMheg")'>Il Mheg</a>
					<a href="#" onclick='setMapJPEG("Kholusia")'>Kholusia</a>
					<a href="#" onclick='setMapJPEG("Lakeland")'>Lakeland</a>
					<a href="#" onclick='setMapJPEG("TheRaktikaGreatwood")'>The Rak'tika Greatwood</a> 
					<a href="#" onclick='setMapJPEG("TheTempest")'>The Tempest</a>
				</div>
		   </div>
		   <div class='dropdown'>
				</div>
		</div>	
    </section>
	
	<section>
        <div id="map"></div>
    </section>
	
    <section>
        <div id="panorama" class="hide">
		<div class="leaflet-control-attribution leaflet-control"› <a href="htt  sWleafletjs.com" title="A JS library for interactive maps">Leaflet</a> </div>
		</div>
		

    </section>
	
    <script>
		var mydata = JSON.parse(data);	
	
		var mapJPEG = localStorage.getItem("mapJPEGSave");
		function setMapJPEG(id) {
			mapJPEG = id;
			localStorage.setItem("mapJPEGSave", mapJPEG);
			setTimeout(location.reload.bind(location), 1);
		}
	
		
		function initStreetViewer(panoramaData) {
 
			let panorama = document.getElementById('panorama');
			panorama.classList.remove('hide');

			const panoramaViewer = pannellum.viewer('panorama', panoramaData);
			
			let map = document.getElementById('map'); 
			map.classList.add('hide');
			
			let btn = document.getElementById('goBack')
			btn.classList.remove('hide');
			btn.addEventListener('click', () => {
				panoramaViewer.destroy();
				panorama.classList.add('hide');
				map.classList.remove('hide');
				btn.classList.add('hide');
			})

		}

		

		async function mapSpotsToMap() {
			const spotsData = await (await fetch('./spots/'+mapJPEG+'.json')).json();
			for (let spot of spotsData) {
				let position = L.latLng([spot.y, spot.x]);
				if ( spot.iconUrl == "./pin-needle.png" ) {
					localIconSize = [14,17];
					localIconAnchor = [7,8];
				}
				else if ( spot.iconUrl == "./marker-icon.png" ) {
					localIconSize = [28,36];
					localIconAnchor = [12,35];
				}
				var mapMarker = L.icon ({
					iconUrl: spot.iconUrl,
					iconSize: localIconSize,
					iconAnchor: localIconAnchor
				})
				
				L.marker(position,{icon:mapMarker}).addTo(map)
				.bindPopup(spot.locationName)
				.on('click', () => {
					initStreetViewer(spot.panoramaData);
				})
			}
		}

		//map
		var map = L.map('map', {
			crs: L.CRS.Simple,
			minZoom: -0.5
		});

		var bounds = [[0, 0], [1000, 1000]];
		var image = L.imageOverlay(mydata[0][mapJPEG], bounds).addTo(map);
		map.fitBounds(bounds);
		
		mapSpotsToMap();
		
		if ( mapJPEG === null ) {
			alert("Choose a map from the top bar to start your journey!");
		}
		
		
		map.on('click', function(e){
		    var coord = e.latlng;
	  	    var lat = coord.lat;
		    var lng = coord.lng;
		    console.log("You clicked the map at y: " + lat + " and x: " + lng);
		});
  
	</script>
    
    <div id="infoBot">
		<i class="fas fa-code"></i> by <a href="https://www.instagram.com/jan.muesli" target="_blank" rel="noopener">Jan Müsli</a>. 
		<a href="https://docs.google.com/forms/d/1PQC1fcJkfZfS0axL4EAiiSYnSBl7LIjVJ_wGHVgYiVM/" target="_blank">Report bug</a>. 
		<a href="https://docs.google.com/forms/d/1qmXvs4flrh136YQ4dhZND3hBfhSZ998ORTM5DWFaHM4/edit" target="_blank">Submit location</a>.
	</div>
</body>
</html>
